#:import Factory kivy.factory.Factory
#:import NoTransition kivy.uix.screenmanager.NoTransition
#:import DataAnnouncement main



<Definition>:
    name:'1'
    MDBoxLayout:
        spacing:5
        padding:5
        orientation:'vertical'
        Button:
            background_color:0,0,0,0

            text: "Open manager"
            icon: "folder"
            on_release:
                app.root.current = 'login'

            canvas.before:
                Color:
                    rgb:rgba(0,207,255,255)
                RoundedRectangle:
                    size:self.size
                    pos:self.pos
                    radius:[5,]
        Button:
            background_color:0,0,0,0
            text: "Clear"
            icon: "Clear"
            on_release:
                root.clear_js()
            canvas.before:
                Color:
                    rgb:rgba(0,207,255,255)
                RoundedRectangle:
                    size:self.size
                    pos:self.pos
                    radius:[5,]


<Five>:
    name:'Five'
    id:general
    #on_enter:app.theme_cls.theme_style = 'Dark'

    orientation:'vertical'

    InternalSlider:

    ToolBar:





<Welcome@MDScreen>:

    name: "SplashScreen"
    on_enter: root.ids.run.start()
    MDBoxLayout:

        MDFloatLayout:

            BoxLayout:
                pos_hint:{'center_y':.2, 'center_x':.5}
                padding: "10dp"
                size_hint_x: .7
                MDProgressBar:
                    color:(255/255,15/255,0/255,1)
                    id: run
                    orientation: "horizontal"
                    type: "determinate"
                    running_duration: 1
                    catching_duration: 1


<ConstructorAnnouncement@Screen>:
    name:'constructor_announcement'
    MDBoxLayout:
        spacing:5
        md_bg_color: rgba(220, 227, 233,255)
        orientation:'vertical'
        padding:0,0,0,5

        MDBoxLayout:
            size_hint:1,None
            height:dp(60)
            md_bg_color: rgba(28, 28, 28,255)
            FloatLayout:
                MDLabel:
                    pos_hint:{'center_x':.5,'center_y':.5}
                    text:"Создать объявление"
                    theme_text_color: "Custom"
                    text_color: rgba(255,255,255,255)
                    font_size:sp(20)
                    halign: "center"



        MDCard:
            md_bg_color:rgba(246, 247, 249,255)
            size_hint:1,.3
            orientation:"vertical"
            radius:20
            padding:"10dp"
            spacing: "10dp"
            MDFloatLayout:

                TextInput:
                    pos_hint:{'center_y':0.5, 'center_x':.5}
                    hint_text:"Заголовок"
                    font_size: '14sp'
                    background_color:1,1,1,0
                    foreground_color:0,0,0,1
                    cursor_color:(255/255,15/255,0/255,1)
                    cursor_width:'2sp'
                    multiline: False
                    id: header
                MDFloatLayout:
                    pos_hint:{'center_y':0.4, 'center_x':.5}
                    size_hint_y:None
                    height:dp(.5)
                    md_bg_color:rgba(178,178,178,255)

                #TextField --------------Замена на TextInput
                #color_mode:'custom'
                #line_color_normal:0,0,0,1
                #line_color_focus: 0,0,0,1
                #helper_text: "Заголовок вашего обьявления"
                #helper_text_mode: "persistent"


        MDCard:

            md_bg_color:rgba(246, 247, 249,255)
            orientation:"vertical"
            radius:20
            padding:"10dp"
            spacing: "10dp"
            MDGridLayout:
                id:card



                cols:3

                spacing:5

                Image:
                    id:img_1

                    source:"img/car_default.png"
                Image:
                    id:img_2
                    source:"img/car_default.png"
                Image:
                    id:img_3
                    source:"img/car_default.png"
                Image:
                    id:img_4
                    source:"img/car_default.png"
                Image:
                    id:img_5
                    source:"img/car_default.png"
                Image:
                    id:img_6
                    source:"img/car_default.png"


            MDRoundFlatIconButton:

                icon: "android"
                text: "Загрузить изображение"
                pos_hint:{'center_x':.5,'center_y':.5}
                line_color: rgba(0,207,255,255)
                text_color:rgba(0,207,255,255)

                theme_icon_color: "Custom"
                icon_color: rgba(0,207,255,255)
                on_release:
                    app.root.children[-1].children[-1].children[-1].manager.transition.direction='left'
                    app.root.children[-1].children[-1].children[-1].manager.transition.duration=.2
                    app.root.children[-1].children[-1].current = 'Ego'
                    app.on_touch(self)
        MDCard:

            md_bg_color:rgba(246, 247, 249,255)
            orientation:"vertical"
            radius:20
            padding: '5dp'
            spacing: "10dp"
            MDFloatLayout:
                size_hint_y:.8
                ScrollView:
                    id:sv

                    pos_hint:{'center_y':0.5, 'center_x':.5}
                    TextInput:
                        size_hint:(1, None)
                        text_size:self.width,1
                        height: max( (len(self._lines)+1) * self.line_height, sv.height)
                        hint_text:"Описание"
                        pos_hint:{'center_y':0.5, 'center_x':.5}
                        font_size: '14sp'
                        background_color:1,1,1,0
                        foreground_color:0,0,0,1
                        cursor_color:(255/255,15/255,0/255,1)
                        cursor_width:'2sp'
                        id:description
                        multiline: True
                MDFloatLayout:
                    pos_hint:{'center_y':0, 'center_x':.5}
                    size_hint_y:None
                    height:dp(.5)
                    md_bg_color:rgba(178,178,178,255)

            MDFloatLayout:
                size_hint_y:.2
                TextInput:
                    id:cost
                    pos_hint:{'center_y':0.5, 'center_x':.5}
                    hint_text:"Желаемая стоимость"
                    font_size: '14sp'
                    background_color:1,1,1,0
                    foreground_color:0,0,0,1
                    cursor_color:(255/255,15/255,0/255,1)
                    cursor_width:'2sp'

                    multiline: False
                MDFloatLayout:
                    pos_hint:{'center_y':0.35, 'center_x':.5}
                    size_hint_y:None
                    height:dp(.5)
                    md_bg_color:rgba(178,178,178,255)


        MDCard:
            md_bg_color:rgba(246, 247, 249,255)
            size_hint:1,.25
            orientation:"horizontal"
            radius:20

            spacing: "10dp"


            FloatLayout:
                MDRaisedButton:
                    pos_hint:{'center_x':.31,'center_y':.5}
                    text: "Сохранить"

                    md_bg_color: rgba(0,207,255,255)
                    on_release:
                        app.save_announcement(root.ids.header.text ,root.ids.description.text ,root.ids.cost.text,[root.ids.img_1.source,root.ids.img_2.source,root.ids.img_3.source,root.ids.img_4.source,root.ids.img_5.source,root.ids.img_6.source])
                        root.ids.header.text=''
                        root.ids.cost.text=''
                        root.ids.description.text=''
                        root.ids.img_1.source="img/car_default.png"
                        root.ids.img_2.source="img/car_default.png"
                        root.ids.img_3.source="img/car_default.png"
                        root.ids.img_4.source="img/car_default.png"
                        root.ids.img_5.source="img/car_default.png"
                        root.ids.img_6.source="img/car_default.png"

                        app.root.children[-1].children[-1].current = 'constructor_announcement'
                MDFlatButton:
                    pos_hint:{'center_x':.69,'center_y':.5}
                    theme_text_color: "Custom"
                    text_color: rgba(0,207,255,255)
                    text: "Отмена"
                    on_release:
                        app.PRINT()






<Ego>:
    name:'Ego'
    MDBoxLayout:
        orientation: 'vertical'

        MDToolbar:
            title: "MDFileManager"
            left_action_items: [['arrow-left', lambda x: app.back_constructor_announcement()]]
            elevation: 10


        MDFloatLayout:

            MDRoundFlatIconButton:
                text: "Open manager"
                icon: "folder"
                pos_hint: {'center_x': .5, 'center_y': .6}
                on_release: app.root.children[-1].children[-1].children[-1].file_manager_open()





<InternalSlider>:
    id:internal_slider

    Block:
        id:block
    Second:
    Ego:
    ConstructorAnnouncement:
    own_announcement:
        id:own
    read:
        id:read

<Second>:

    MDCard:

        md_bg_color:rgba(28, 28, 28,255)
        Button:

            text:"В разработке"
            size_hint:.66,.065
            background_color:0,0,0,0
            pos_hint:{'center_x':.5,'top':.1}



            canvas.before:
                Color:
                    rgb:rgba(0,207,255,255)
                RoundedRectangle:
                    size:self.size
                    pos:self.pos
                    radius:[5,]




<Block>:

    MDGridLayout:
        cols:1
        SearchBar:
        RV:



<SearchBar@MDScreen>:
    size_hint:1,None
    height:60
    #md_bg_color:.98,.25,.0,1
    md_bg_color:rgba(35, 36, 38,255)


    FloatLayout:
        DotsHorizontal:

        SearchStringWithButton:
            id:search_string



<SearchStringWithButton@MDBoxLayout>

    size_hint:.8,1
    pos_hint:{'right':1,'y':0}
    radius: [18,24,24,18]
    md_bg_color: rgba(17, 17, 17,255)

    MDRelativeLayout:
        SearchString:
            id:ss


    MDIconButton:

        id: search_field_button
        pos_hint:{'right':1,'center_y':.5}

        theme_text_color: "Custom"           ###
        text_color: rgba(255,255,255,255)          ###
        icon:'magnify'
        on_release:
            app.rv_constructor_clock(self,root.ids.ss.text)





<SearchString@MDTextField>:


    font_size: '14sp'
    pos:(15,0)
    id: search_field
    hint_text: 'Search'

    color_mode:"custom"
    disabled_hint_text_color:rgba(255,255,255,255)
    #helper_text: "Search"
    #helper_text_mode: "on_focus"



    current_hint_text_color:rgba(120,125,132,255)
    line_color_normal:rgba(120,125,132,255)
    line_color_focus: rgba(255,255,255,255)
    text_color:rgba(255,255,255,255)

    size_hint: .9, 1



<RV>:

    canvas.before:
        Color:
            rgba: rgba(220, 227, 233,255)
        Rectangle:
            size: self.size
            pos: self.pos

    on_scroll_stop:

        if self.effect_y.max<0:app.rv_constructor_clock(self) if self.effect_y.value+50<self.effect_y.max or self.effect_y.value>50 else None
        else:app.rv_constructor_clock(self) if self.effect_y.value-50>self.effect_y.max or self.effect_y.max-50>self.effect_y.value else None

    data: app.data                                                    ###

    id: rv
    key_viewclass: 'viewclass'
    RecycleBoxLayout:

        spacing:5
        padding:0,5,0,5
        default_size: None, dp(100)

        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'

<own_announcement>:
    MDBoxLayout:
        spacing:5
        md_bg_color: rgba(220, 227, 233,255)
        orientation:'vertical'
        padding:0,0,0,5

        MDBoxLayout:
            size_hint:1,None
            height:dp(60)
            md_bg_color: rgba(28, 28, 28,255)
            FloatLayout:
                MDLabel:
                    pos_hint:{'center_x':.5,'center_y':.5}
                    text:"Сохранённые объявления"
                    theme_text_color: "Custom"
                    text_color: rgba(255,255,255,255)
                    font_size:sp(20)
                    halign: "center"

        own:



<read>
    source_1:''
    source_2:''
    source_3:''
    source_4:''
    source_5:''
    source_6:''
    header:''
    description:''
    ad_id:''
    personal_id:''
    price:''
    id:read
    name: 'read'

    MDBoxLayout:
        orientation:'vertical'
        spacing:5
        md_bg_color: rgba(220, 227, 233,255)
        MDFloatLayout:
            pos_hint:{'center_x':.5,'top':1}
            size_hint:1,None
            height:dp(60)
            md_bg_color: rgba(28, 28, 28,255)
            MDLabel:
                pos_hint:{'center_x':.5,'center_y':.5}
                text:"Сохранённые объявления"
                theme_text_color: "Custom"
                text_color: rgba(255,255,255,255)
                font_size:sp(20)
                halign: "center"


        MDFloatLayout:

            MDCard:
                size_hint:.95,.4
                pos_hint:{'center_x':.5,'top':1}
                id:parent
                radius:20
                md_bg_color:1,1,1,.7
                MDCarousel:
                    id:slide
                    Image:
                        id:img_1

                        source:root.source_1
                    Image:
                        id:img_2
                        source:root.source_2
                    Image:
                        id:img_3
                        source:root.source_3
                    Image:
                        id:img_4
                        source:root.source_4
                    Image:
                        id:img_5
                        source:root.source_5
                    Image:
                        id:img_6
                        source:root.source_6



            MDCard:
                id:parent_1
                radius:20
                md_bg_color:1,1,1,.7

                size_hint:.95,.08
                pos_hint:{'center_x':.5,'top':.59}


                ScrollView:
                    id:sv
                    size_hint:(.9, .5)
                    pos_hint:{'center_x':.5,'center_y':.5}
                    Label:

                        multiline:False


                        size_hint:(1, None)
                        text_size:self.width,None
                        height: self.texture_size[1]
                        text:root.header if root.header!='' else 'Заголовок не найден'
                        color:0,0,0,1

            MDCard:
                id:parent
                radius:20
                md_bg_color:1,1,1,.7
                size_hint:.95,.4
                pos_hint:{'center_x':.5,'top':.5}
                ScrollView:
                    id:sv
                    size_hint:(.9, .89)
                    pos_hint:{'center_x':.5,'center_y':.5}
                    Label:

                        multiline:True
                        text:'Описание:'+root.description  if root.description!='' else 'Описание отсутствует'
                        size_hint:(1, None)
                        text_size:self.width,None
                        height: self.texture_size[1]
                        color:0,0,0,1


            MDCard:
                id:parent
                radius:20
                size_hint:.95,.08
                pos_hint:{'center_x':.5,'top':.09}
                md_bg_color:1,1,1,.7

                ScrollView:
                    id:sv
                    size_hint:(.8, .5)
                    pos_hint:{'center_x':.5,'center_y':.5}
                    Label:

                        multiline:False
                        text:f"Стоимость:{root.price if root.price!='' else 'Цена не указана'}"
                        color:0,0,0,1
                        size_hint:(1, None)
                        text_size:self.width,None
                        height: self.texture_size[1]



        #ScrollView:
        #        id:sv
#
        #        pos_hint:{'center_y':0.5, 'center_x':.5}
        #        TextInput:
        #            size_hint:(1, None)
        #            text_size:self.width,1
        #            height: max( (len(self._lines)+1) * self.line_height, sv.height)
        #            hint_text:"Описание"
        #            pos_hint:{'center_y':0.5, 'center_x':.5}
        #            font_size: '14sp'
        #            background_color:1,1,1,0
        #            foreground_color:0,0,0,1
        #            cursor_color:(255/255,15/255,0/255,1)
        #            cursor_width:'2sp'
        #            id:description
        #            multiline: True
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





<own>:

    canvas.before:
        Color:
            rgba: rgba(220, 227, 233,255)
        Rectangle:
            size: self.size
            pos: self.pos

    on_scroll_stop:

        if self.effect_y.max<0:app.own_rv_constructor_timer(self) if self.effect_y.value+50<self.effect_y.max or self.effect_y.value>50 else None
        else:app.own_rv_constructor_timer(self) if self.effect_y.value-50>self.effect_y.max or self.effect_y.max-50>self.effect_y.value else None

    data: app.own_data                                                ###

    id: rv
    key_viewclass: 'viewclass'
    RecycleBoxLayout:

        spacing:5
        padding:0,5,0,5
        default_size: None, dp(100)

        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'

<Announcement>:

    img:''
    header:''
    description:''
    ad_id:''
    price:''
    MDCard:
        md_bg_color:rgba(246, 247, 249,255)

        pos_hint:{'center_x':.5,'y':0}

        orientation:"vertical"
        radius:20
        padding:"10dp"
        TwoLineIconListItem:
            on_release:
                app.reading(root)
                app.root.children[-1].children[-1].current = 'read'

            text: root.header
            secondary_text: root.description
            #pos_hint:{'center_x':.5,'y':0}



            Image:
                size_hint:.25,1
                #source: id[1].ad_id
                source: root.img
                pos_hint:{'x':0,'center_y':.5}


<ToolBar@Screen+FakeRectangularElevationBehavior+MDFloatLayout>:

    id:toolbar

    #md_bg_color: .98,.25,.0,1
    md_bg_color: rgba(28,28,28,255)
    #(255/255,15/255,0/255,1)

    #elevation: 5
    size_hint:1,None
    width:self.width
    height:50


    CarSports:
        button_width: root.width/5

    StarOutline:
        button_width: root.width/4

    PlusBoxMultipleOutline:
        button_width: root.width/4

    EmailMultipleOutline:
        button_width: root.width/4

    HomeVariantOutline:
        button_width: root.width/5

##############   BTN   #############

<CarSports@On_active_button>:
    #text: "Cars"
    #text_size:sp(14)
    id:car_sports
    icon:'car-sports'
    pos_hint:{'center_x':.1,'center_y':.5}


    on_release:

        app.root.children[-1].children[-1].children[-1].manager.transition.direction=app.root.children[-1].tr(app.root.children[-1].index_1)
        app.root.children[-1].children[-1].children[-1].manager.transition.duration=.2
        app.root.children[-1].children[-1].current = 'menu'



<StarOutline@On_active_button>:
    #text: "Home"
    id:star_outline
    icon:'star-outline'
    pos_hint:{'center_x':.3,'center_y':.5}

    on_release:
        app.root.children[-1].children[-1].children[-1].manager.transition.direction=app.root.children[-1].tr(app.root.children[-1].index_2)
        app.root.children[-1].children[-1].children[-1].manager.transition.duration=.2
        app.root.children[-1].children[-1].current = 'own_announcement'

<PlusBoxMultipleOutline@On_active_button>:
    #text: "Home"
    id:plus_box_multiple_outline
    icon:'plus-box-multiple-outline'
    pos_hint:{'center_x':.5,'center_y':.5}

    on_release:
        app.root.children[-1].children[-1].children[-1].manager.transition.direction=app.root.children[-1].tr(app.root.children[-1].index_3)
        app.root.children[-1].children[-1].children[-1].manager.transition.duration=.2
        app.root.children[-1].children[-1].current = 'constructor_announcement'



<EmailMultipleOutline@On_active_button>:
    #text: "Home"
    id:email_multiple_outline
    icon:'email-multiple-outline'
    pos_hint:{'center_x':.7,'center_y':.5}

    on_release:
        app.root.children[-1].children[-1].children[-1].manager.transition.direction=app.root.children[-1].tr(app.root.children[-1].index_4)
        app.root.children[-1].children[-1].children[-1].manager.transition.duration=.2
        app.root.children[-1].children[-1].current = 'btn'

<HomeVariantOutline@On_active_button>:
    #text: "Home"
    id:home_variant_outline
    icon:'home-variant-outline'

    pos_hint:{'center_x':.9,'center_y':.5}

    on_release:
        app.root.children[-1].children[-1].children[-1].manager.transition.direction=app.root.children[-1].tr(app.root.children[-1].index_5)
        app.root.children[-1].children[-1].children[-1].manager.transition.duration=.2
        app.root.children[-1].children[-1].current = 'btn'


<DotsHorizontal@MDIconButton>
    id:dots_horizontal
    icon:'dots-horizontal'
    pos_hint:{'x':0,'center_y':.5}
    theme_text_color: "Custom"
    text_color:rgba(255,255,255,255)


    on_release:
        app.root.children[-1].manager.transition.duration=.5
        app.root.current = '1'

<On_active_button>
    icon_color:
    theme_icon_color: "Custom"           ###
    icon_color: rgba(255,255,255,255)       #rgba(120,125,132,255)

    text_color:
        app.theme_cls.text_color if not root.selected_item \
        else (1, 1, 1, 1)
    button_bg_color: rgba(34,35,37,255)
    mode: "color_on_normal"
    badge_disabled: True

<NavigationButton@Button_Item>
    icon_color: app.theme_cls.text_color
    text_color: app.theme_cls.text_color
    button_bg_color: app.theme_cls.primary_color
    mode: 'color_on_active'
    badge_disabled: True